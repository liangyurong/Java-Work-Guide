### mysql怎么实现事务的?

本质可以归纳为mysql是怎么去维持ACID这四种特性。

A是原子性，也就是在一个事务中的几个操作，要么同时成功，要么同时失败。

    innodb设置一个undo log表。在事务执行过程中会记录相关的操作到表，一旦需要回滚，则从里面读取数据进行反向操作达到回滚的目的。

C是一致性。

    一致性怎么保证？
        第一，由其他三大特性保证。
        第二，程序代码要保证业务逻辑上的一致性。

I是隔离性。简单来说就是多个事务在执行中不互相干扰，也就是不会出现数据混乱的问题。

    通过四种隔离级别来解决这个问题。默认是不可重复读级别。

    mvcc机制解决了脏读和不可重复读。

    使用行锁和表锁，解决幻读的问题

D是持久性。只要事务执行成功，那么对数据的影响是持久性的，不会因为数据库宕机或者其他原因导致数据变更失效。

    随机磁盘IO的效率太低，因此innodb设置了一个缓冲区。

    当数据发生变更，先更新缓冲区，然后在合适的时间再持久化到磁盘。

    当然，为了避免磁盘io的时候发生数据库宕机，innodb还设置了redolog表来存储每次数据更新后的值。一旦数据库宕机，当重启之后就可以使用redolog来保证数据的持久性、

