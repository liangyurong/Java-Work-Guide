### 杂

1. 索引是一种数据结构

### 什么是索引

在关系型数据库中，如果有上万乃至上亿的记录，在查找记录的时候，想要获得非常快的速度，就必须要使用索引。

简单来说：索引就像书的目录， 通过书的目录就准确的定位到了书籍具体的内容。

索引是对记录按照多个字段进行排序的一种方式。对表中的某个字段建立索引会创建另一种数据结构，其中保存着字段的值，每个值又指向与它相关的记录。这种索引的数据结构是经过排序的，因而可以对其执行二分查找。

索引的缺点是占用额外的磁盘空间。因为索引保存在MyISAM数据库中，所以如果为同一个表中的很多字段都建立索引，那这个文件可能会很快膨胀到文件系统规定的上限。



### 原理

添加索引后，字段本身就经过了排序，然后放到索引的节点上去

检索效率达到LogN

### 问题

1. 为什么要给表加上主键？
2. 为什么加索引后会使查询变快？
3. 为什么加索引后会使写入、修改、删除变慢？
4. 什么情况下要同时在两个字段上建索引？
5. 1. 
6. B+树的实现细节是什么？B-树和B+树有什么区别？联合索引在B+数据中如何存储？
7. 

#### 为什么采用B-Tree而不是二叉查找树

减少磁盘IO的次数就必须要压缩树的高度，让瘦高的树尽量变成矮胖的树

在数据量非常庞大的情况下，磁盘io的次数会变得非常多

系统从磁盘读取数据到内存时是以磁盘块（block）为基本单位的，位于同一个磁盘块中的数据会被一次性读取出来

### 连环提问

**MySQL的数据库索引是基于什么数据结构？**

1. 基于Hash表或者是B+树

**数据库索引为什么用树结构？**

1. 树的查询效率高，并且可以保持有序

**那为什么没有用二叉查找树呢？**

从算法逻辑上讲，二叉查找树的查找速度和比较次数都是最小的，但是还需要考虑的一个问题是磁盘的io次数。数据库索引是存储在磁盘上的，当数据量比较庞大的时候，索引可能有几个g甚至更多。当利用索引进行查询的时候，显然不可能将整个索引全部加载到内存，能做的只是逐一加载每一个磁盘页，这里的磁盘页对应着索引树的节点。


在最坏的情况下，磁盘io的次数等于树的高度。



## 廖雪峰的数据库索引

在关系数据库中，如果有上万甚至上亿条记录，在查找记录的时候，想要获得非常快的速度，就需要使用索引。

索引是关系数据库中对某一列或多个列的值进行预排序的数据结构。通过使用索引，可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，这样就大大加快了查询速度。

例如，对于`students`表：

| id   | class_id | name | gender | score |
| :--- | :------- | :--- | :----- | :---- |
| 1    | 1        | 小明 | M      | 90    |
| 2    | 1        | 小红 | F      | 95    |
| 3    | 1        | 小军 | M      | 88    |

如果要经常根据`score`列进行查询，就可以对`score`列创建索引：

```mysql
ALTER TABLE students
ADD INDEX idx_score (score);
```

使用`ADD INDEX idx_score (score)`就创建了一个名称为`idx_score`，使用列`score`的索引。索引名称是任意的，索引如果有多列，可以在括号里依次写上，例如：

```mysql
ALTER TABLE students
ADD INDEX idx_name_score (name, score);
```

索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如`gender`列，大约一半的记录值是`M`，另一半是`F`，因此，对该列创建索引就没有意义。

可以对一张表创建多个索引。索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。

对于主键，关系数据库会自动对其创建主键索引。使用主键索引的效率是最高的，因为主键会保证绝对唯一。

### 唯一索引

在设计关系数据表的时候，看上去唯一的列，例如身份证号、邮箱地址等，因为他们具有业务含义，因此不宜作为主键。

但是，这些列根据业务要求，又具有唯一性约束：即不能出现两条记录存储了同一个身份证号。这个时候，就可以给该列添加一个唯一索引。例如，我们假设`students`表的`name`不能重复：

```mysql
ALTER TABLE students
ADD UNIQUE INDEX uni_name (name);
```

通过`UNIQUE`关键字我们就添加了一个唯一索引。

也可以只对某一列添加一个唯一约束而不创建唯一索引：

```mysql
ALTER TABLE students
ADD CONSTRAINT uni_name UNIQUE (name);
```

这种情况下，`name`列没有索引，但仍然具有唯一性保证。

无论是否创建索引，对于用户和应用程序来说，使用关系数据库不会有任何区别。这里的意思是说，当我们在数据库中查询时，如果有相应的索引可用，数据库系统就会自动使用索引来提高查询效率，如果没有索引，查询也能正常执行，只是速度会变慢。因此，索引可以在使用数据库的过程中逐步优化。

### 小结

通过对数据库表创建索引，可以提高查询速度。

通过创建唯一索引，可以保证某一列的值具有唯一性。

数据库索引对于用户和应用程序来说都是透明的。

## 其他面试知识

数据库创建索引能够大大提高系统的性能。
第一，通过创建唯一性的索引，可以保证数据库表中每一行数据的唯一性。
第二，可以大大加快数据的检索速度，这也使创建索引的最主要的原因。
第三，可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。
第四，在使用分组和排序子句进行数据检索时，同样可以显著的减少查询中查询中分组和排序的时间。
第五，通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。

增加索引也有许多不利的方面。
第一，创建索引和维护索引需要消耗时间，这种时间随着数量的增加而增加。
第二，索引需要占物理空间，除了数据表占据数据空间之外，每一个索引还要占一定的物理空间，如果要建立聚簇索引，那么需要额空间就会更大。
第三，当对表中的数据进行增加，删除和修改的时候，索引也要动态的维护，这样就降低了数据的维护速度。

应该对如下的列建立索引

1. 在作为主键的列上，强制该列的唯一性和组织表中数据的排列结构。
2. 在经常用在连接的列上，这些列主要是一些外键，可以加快连接的速度。
3. 在经常需要根据范围进行搜索的列上创建索引，因为索引已经排序，其指定的范围是连续的。
4. 在经常需要排序的列上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间。
5. 在经常使用在where子句中的列上面创建索引，加快条件的判断速度。

有些列不应该创建索引

1. 在查询中很少使用或者作为参考的列不应该创建索引。
2. 对于那些只有很少数据值的列也不应该增加索引（比如性别，结果集的数据行占了表中数据行的很大比例，即需要在表中搜索的数据行的比例很大。增加索引，并不能明显加快检索速度）。
3. 对于那些定义为text，image和bit数据类型的列不应该增加索引。这是因为，这些列的数据量要么相当大，要么取值很少。
4. 当修改性能远远大于检索性能时，不应该创建索引，因为修改性能和检索性能是矛盾的。

创建索引的方法：直接创建和间接创建（在表中定义主键约束或者唯一性约束时，同时也创建了索引）。
索引的特征：
唯一性索引和复合索引。唯一性索引保证在索引列中的全部数据是唯一的，不会包含冗余数据。复合索引就是一个索引创建在两个列或者多个列上。可以减少一在一个表中所创建的索引数量。



### 数据库索引生效问题

索引是否生效主要取决于字段类型：

1. 如果字段类型为字符串，需要给in查询中的数值与字符串值都需要添加引号，索引才能起作用。

2. 如果字段类型为int，则in查询中的值不需要添加引号，索引也会起叙用。

IN的字段，在联合索引中，按以上方法，也会起作用。

3.mysql查询优化器认为全表扫描时如果速度大于使用索引，就会不用索引，你可以使用FORCE INDEX强制mysql使用索引