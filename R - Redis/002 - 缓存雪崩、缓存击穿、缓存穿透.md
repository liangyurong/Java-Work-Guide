

### 常见的术语

QBS，queries per second：一台服务器每秒能够响应的查询次数。

### 为什么要用缓存？

有些数据，查询或者运算需要花很多时间。我们可以在某次获取到该数据后就把它放在可以快速取到的地方，比如内存或者redis之类的缓存服务，这样子我们下次需要数据就可以快速拿到。

### 缓存雪崩 （很多雪花，说明很多key失效了）

某一时刻大规模的key失效。

怎么解决缓存雪崩？

- 在雪崩发生前，使用集群缓存。
- 在发生缓存雪崩的时候，使用限流和降级。
- 雪崩发生后，开启redis持久化机制，尽快恢复缓存集群。
  - 将key的过期时间加上一个随机数，让key均匀过期。
  - 热点数据可以考虑不失效。

### 缓存击穿 （同时针对一个key）

大量请求同时查询同一个key，刚好这个key失效了，就会导致大量的请求打到数据库。这种现象称为缓存击穿。

怎么解决缓存击穿？

在第一个查询数据的请求上使用一个互斥锁。等到第一个线程查询到数据，然后做缓存。

### 缓存穿透

对一个不存在的id进行大量请求，比如id为-1，从而导致每次的请求都需要到数据库查找。

怎么解决缓存穿透？

将那些不存在的key对应的值设为null，然后放到redis。并且设置好过期时间。

过期时间最长不超过五分钟。
