### 自我保护机制

本质：好死不如赖活着

一句话概括

    某时刻某一个微服务挂了，eureka不会立刻清理，依旧会对该微服务的信息进行保存。

自我保护模式正是一种针对网络异常波动的安全保护措施，使用自我保护模式能使 Eureka 集群更加的健壮、稳定的运行。

### 默认情况下

描述：如果EurekaServer在一定的时间内没有接收到某个服务的心跳，EurekaServer将会注销该实例。（90s）

存在问题：但是当网络分区发生故障时，微服务与Eureka之间无法正常通信，以上行为可能会变得十分危险。

    因为微服务本身是健康的，此时本不应该注销这个服务。

解决

    当EurekaServer节点在短时间内丢失过多的客户端时（可能发生了网络分区故障），那么这个节点就会自动进入自我保护模式、

    一旦进入该模式，EurekaServer就会保护服务注册表中的信息，不再删除服务注册表中的数据，也就是不会注销任何微服务数据。

    当网络故障恢复后，该EurekaServer节点会自动退出自我保护模式。

### 在自我保护模式下

EurekaServer会保护服务注册表中的信息，不再注销任何服务实例。

当它收到的心跳数重新恢复道阈值以上，该EurekaServer节点会自动退出自我保护模式。

它的设计哲学就是宁可保留错误的服务注册信息，也不盲目注销任何可能健康的服务实例。


### 综述

自我保护模式是一种应对网络异常的安全保护措施。

使用该保护机制，可以让Eureka集群更加健壮和稳定。

















