
### 堆

1、堆内存用来存放由new创建的对象和数组

2、在堆中分配的内存，由Java虚拟机的自动垃圾回收器来管理。

3、在堆中产生了一个数组或对象后，在栈中定义一个特殊的变量，让栈中这个变量的取值等于数组或对象在堆内存中的首地址，栈中的这个变量就成了数组或对象的引用变量。
- 引用变量就相当于是为数组或对象起的一个名称，以后就可以在程序中使用栈中的引用变量来访问堆中的数组或对象。

4、引用变量就相当于是为数组或者对象起的一个名称。
- 引用变量是普通的变量，定义时在栈中分配，引用变量在程序运行到其作用域之外后被释放。
- 而数组和对象本身在堆中分配，即使程序运行到使用 new 产生数组或者对象的语句所在的代码块之外，数组和对象本身占据的内存不会被释放，数组和对象在没有引用变量指向它的时候，才变为垃圾，不能在被使用，但仍然占据内存空间不放，在随后的一个不确定的时间被垃圾回收器收走（释放掉）。这也是java比较占内存的原因。
- 实际上，栈中的变量指向堆内存中的变量，这就是java中的指针！

5、new出来的东西都放在堆内存。
- string str=new string(“s”);
- str在栈内存，实际的string对象在堆内存，str指向string对象在堆内存中的首地址。
- str实际存储的是string对象在堆内存中的首地址。
- new出来的数组也是一个对象。

### 栈

1、在方法中定义的基本类型的变量数据（int, short, long, byte, float, double, boolean, char）和对象的引用变量都在函数的栈内存中分配。
- 栈内存中的数据使用完毕会自动释放
- 局部变量都放在栈内存中。比如for循环，while循环里面的变量，还有方法的参数。
- string str=“aaa”; str直接存储在栈内存中的常量池，str存储着字符串符号aaa

2、栈中主要存放一些基本类型的变量数据和对象句柄(引用)。

3、当在一段代码块定义一个变量时，Java就在栈中为这个变量分配内存空间，当该变量退出该作用域后，Java会自动释放掉为该变量所分配的内存空间，该内存空间可以立即被另作他用。

4、每个线程包含一个栈区，每个栈中的数据(原始类型和对象引用)都是私有的，其他栈不能访问。栈分为3个部分：基本类型变量区、执行环境上下文、操作指令区(存放操作指令)。

5、优势：存取速度比堆要快，仅次于寄存器，栈数据可以共享(指的是线程共享，而给进程共享)

6、缺点：存在栈中的数据大小与生存期必须是确定的，缺乏灵活性。

7、举例子
```text
栈存的一个是基本的数据类型，int i = 1; 其实i是一个指向int类型的引用。

1存在栈中，i指向1的地址（作用和指针一个样），如果此时有int j = 1; 由于共享性，就不会再开辟一个新的1的地址。直接让i和j指向同一个地址。
```

### 方法区

1、方法区跟堆一样，被所有的线程共享。用于存储已经被虚拟机加载的类信息、常量、静态变量、运行常量池，字符串常量池、即时编译器编译后的代码。

2、方法区存着类的信息，常量和静态变量，即类被编译后的数据。更加详细一点的说法是方法区里存放着类的版本，字段，方法，接口和常量池。常量池里存储着字面量和符号引用。

3、符号引用包括
- 类的全限定名
- 字段名和属性
- 方法名和属性。

4、方法区里存class文件信息和class文件常量池是个什么关系。

5、class文件常量池和运行时常量池是什么关系。

6、其他
- java虚拟机规范中定义方法区是堆的一个逻辑部分。
- 

7、方法区的特点

- 线程共享。 方法区是堆的一个逻辑部分，因此和堆一样，都是线程共享的。整个虚拟机中只有一个方法区。

- 永久代。 方法区中的信息一般需要长期存在，而且它又是堆的逻辑分区，因此用堆的划分方法，把方法区称为“永久代”。

- 内存回收效率低。 方法区中的信息一般需要长期存在，回收一遍之后可能只有少量信息无效。主要回收目标是：对常量池的回收；对类型的卸载。

- Java 虚拟机规范对方法区的要求比较宽松。 和堆一样，允许固定大小，也允许动态扩展，还允许不实现垃圾回收。



### 常量池

1、常量池指的是在编译期被确定，并被保存在已编译的.class文件中的一些数据。

2、除了包含代码中所定义的各种基本类型（如int、long等等）和对象型（如String及数组）的常量值(final)还包含一些以文本形式出现的符号引用，比如：类和接口的全限定名； 字段的名称和描述符； 方法和名称和描述符。

3、虚拟机必须为每个被装载的类型维护一个常量池。常量池就是该类型所用到常量的一个有序集和，包括直接常量（string,integer和floating point常量）和对其他类型，字段和方法的符号引用。

4、对于String常量，它的值是在常量池中的。而JVM中的常量池在内存当中是以表的形式存在的，对于String类型，有一张固定长度的CONSTANT_String_info表用来存储文字字符串值，注意：该表只存储文字字符串值，不存储符号引用。说到这里，对常量池中的字符串值的存储位置应该有一个比较明了的理解了。在程序执行的时候,常量池会储存在方法区（Method Area）,而不是堆中。

5、其他
- jdk1.6之前在方法区。
- jdk1.7之后在堆中。
